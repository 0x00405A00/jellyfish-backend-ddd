@attribute [Route(RouteConst.Routes.Home)]
@using Microsoft.AspNetCore.Http
@inject WebApiRestClient WebApiClient
@inject ILocalStorageService LocalStorageService
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime;

<MudTimeline>
    <MudVirtualize Items="@UsersList" T="UserDTO" OverscanCount="10">
        <MudTimelineItem Color="MudBlazor.Color.Info" Size="Size.Small">
            <ItemOpposite>
                <MudText Color="MudBlazor.Color.Info" Typo="Typo.h5">1970</MudText>
            </ItemOpposite>
            <ItemContent>
                <MudText Color="MudBlazor.Color.Info" Typo="Typo.h6" GutterBottom="true">Atom Towns</MudText>
                <MudText>Construction of the town of Pripyat, one of 9 “atom towns” begins, to be inhabited by future employees of the nuclear power plants.</MudText>
            </ItemContent>
        </MudTimelineItem>
        <MudTimelineItem Color="MudBlazor.Color.Success" Size="Size.Small">
            <ItemOpposite>
                <MudText Color="MudBlazor.Color.Success" Typo="Typo.h5">1977</MudText>
            </ItemOpposite>
            <ItemContent>
                <MudText Color="MudBlazor.Color.Success" Typo="Typo.h6" GutterBottom="true">Operational</MudText>
                <MudText>The first of the Chernobyl Nuclear Power Plants four reactors is ready to operate followed by number 2 in 1978.</MudText>
            </ItemContent>
        </MudTimelineItem>
        <MudTimelineItem Color="MudBlazor.Color.Error" Size="Size.Small">
            <ItemOpposite>
                <MudText Color="MudBlazor.Color.Error" Typo="Typo.h5">1979</MudText>
            </ItemOpposite>
            <ItemContent>
                <MudText Color="MudBlazor.Color.Error" Typo="Typo.h6" GutterBottom="true">Pripyat</MudText>
                <MudText>Pripyat officially proclaimed as a city.<br />The Chernobyl Atomic Power Station reaches its first 10 billion kilowatt-hours of electical output.</MudText>
            </ItemContent>
        </MudTimelineItem>
    </MudVirtualize>
    
</MudTimeline>

@code {

    private CancellationTokenSource cancellationToken = new();
    public List<UserDTO> UsersList=new List<UserDTO>();


    public Home()
    {
    }
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if(firstRender)
        {
            await GetData();
            StateHasChanged();
        }
    }
    private async Task GetData()
    {

        var token = await LocalStorageService.GetDeserializedJsonItemFromKey<AuthDTO>(AuthorizationConst.BrowserLocalStorageItemKey.Authorization);
        var response = await WebApiClient.Request<List<UserDTO>, object>("/user", RestSharp.Method.Get, cancellationToken.Token, null, headers: new List<KeyValuePair<string, string>>() { new KeyValuePair<string, string>("Authorization", token.Token) });
        if (response.IsSuccess)
        {
            UsersList = response.ApiResponseDeserialized;
        }
    }
    public async Task OnScroll(EventArgs e)
    {
        
    }
}
